# hack-sound-service
This is a dbus-based server that plays sounds given a metadata file and a bunch of sound files.

# Getting started
To test this project, please follow these steps:

## 1. Clone the repository
Open a terminal. In Endless OS, search "terminal" in the desktop, to find and open a terminal. Then, type the following command:
```
git clone https://github.com/endlessm/hack-sound-server/
cd hack-sound-server/
```
## 2. Build and install the server
To build and install you can use the build-flatpak.sh script in the root directory. It will build the current branch and install the flatpak directly.
```
./build-flatpak.sh
```
If a password is requested, input it.

## 3. Play a sound!
Just type this following command in the terminal to play a sound:
```
gdbus call --session --dest com.endlessm.HackSoundServer --object-path /com/endlessm/HackSoundServer --method com.endlessm.HackSoundServer.PlaySound framework/piano/1
```

Sounds are registered internally by a tag known as the "sound event id". The server includes these following sound event ids available:
```
framework/drumkit/0
framework/drumkit/1
framework/drumkit/2
framework/drumkit/3
framework/drumkit/4
framework/drumkit/5
framework/piano/0
framework/piano/1
framework/piano/2
framework/piano/3
framework/piano/4
framework/piano/5
framework/scifi/0
framework/scifi/1
framework/scifi/2
framework/scifi/3
framework/scifi/4
framework/scifi/5
```
The previously listed sound event ids are specified in a metadata file located at `data/sounds/metadata.json`. More descriptions about the metadata file will be explained in the next section.
>>> Do not think that there is a pattern for sound event ids. For example, `framework/scifi/5` is just a a string, it could have been called `scifi-5WhatEver`, too. 

# Metadata file
Metadata files describe the behavior of sounds. The **hack-sound-server** reads from the metadata file to know what sounds are available and to know how to play them. The default metadata that the **hack-sound-server** uses is located at `data/sounds/metadata.json`.
>>> Do not edit this file if you are just testing the sounds. Instead override it (more detauls in the next subsection).

An example of metadata file is the following:
```
{
    "framework/drumkit/0": {
        "sound-file": "drumkit/176980__snapper4298__kick-2-with-start.wav",
        "license": "CC-BY",
        "source": "freesound.org"
    },
    "framework/piano/0": {
        "sound-file": "piano/39177__jobro__piano-ff-030.wav",
        "license": "CC-BY",
        "source": "freesound.org"
    }
```
This metadata file specifies two sound event ids: `framework/drumkit/0` and `framework/piano/0`. Then each entry, tells what is the location of the audio file (`sound-file`), the license of the sound (`license`) and the source where it was obtained from (`source`).

## Overriding the metadata file
To override metadata files or add more sounds, you can create your own metadata file. **All the sounds specified there will have the highest priority**.

Create a file in the following path `$HOME/.var/app/com.endlessm.HackSoundServer/data/hack-sound-server/metadata.json`.
>>> `$HOME` represents your home directory.
>>> `.var` is a hidden directory. You can show hidden files with the keys `ctrl` + `h` in the Endless OS file browser.

Once you have created that file, you can add for example the following content:
```
{
    "water": {
        "sound-file": "water.wav"
    },
    "framework/piano/0": {
        "sound-file": "beep.wav",
    }
}
```
>>> Beware of closing curly braces properly.

Then you should create the folder `sounds` in `$HOME/.var/app/com.endlessm.HackSoundServer/data/hack-sound-server/` and put your sounds files there. In this case, you would have to put the sound file `water.wav` and `beep.wav`.

### Playing sounds
You can test the `water` sound event id when you input this command in a terminal:
```
gdbus call --session --dest com.endlessm.HackSoundServer --object-path /com/endlessm/HackSoundServer --method com.endlessm.HackSoundServer.PlaySound water
```

If you run the following command on a terminal, this will actually play the sound `beep.wav` because it was specified so in your metadata file.
```
gdbus call --session --dest com.endlessm.HackSoundServer --object-path /com/endlessm/HackSoundServer --method com.endlessm.HackSoundServer.PlaySound framework/piano/1
```
### Stop a sound
When you input the previous commands to play a sound you must have seen that something like the following has been output:
```
('a72276d2-a856-4531-aac1-59fe1d331fc1',)
```
This is the identifier of the sound you have told to play and you can use it to stop it.
```
gdbus call --session --dest com.endlessm.HackSoundServer --object-path /com/endlessm/HackSoundServer --method com.endlessm.HackSoundServer.StopSound a72276d2-a856-4531-aac1-59fe1d331fc1
```
